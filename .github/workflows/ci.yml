# .github/workflows/ci.yml
name: LightOS Kernel CI

on:
  # Executa o workflow em todo push para a branch 'main'
  push:
    branches: [ "main" ]
  # Executa o workflow em todo Pull Request aberto para 'main'
  pull_request:
    branches: [ "main" ]
  # Permite a execu칞칚o manual na aba 'Actions'
  workflow_dispatch:

jobs:
  build_kernel:
    name: Build (C & Rust)
    runs-on: ubuntu-latest
    
    steps:
      - name: 拘勇 Checkout do C칩digo
        uses: actions/checkout@v4

      # --- Configura칞칚o do Ambiente C ---
      - name: 丘뙖잺 Instalar Compiladores C/C++ (GCC/Clang) e Utilit치rios
        run: |
          sudo apt-get update
          # build-essential inclui gcc, g++, make e libc-dev
          sudo apt-get install -y build-essential nasm xorriso mtools
          # nasm (Assembly), xorriso (para criar ISO) s칚o comuns em desenvolvimento de kernel.

      # --- Configura칞칚o do Ambiente Rust ---
      - name: 游 Instalar Toolchain Rust (Nightly para no_std/kernel)
        uses: dtolnay/rust-toolchain@stable
        with:
          # Kernels geralmente precisam da toolchain nightly para usar recursos inst치veis
          # como a customiza칞칚o do p칙nico e a build-std.
          toolchain: nightly
          # Adiciona o alvo de cross-compilation para arquitetura bare-metal x86_64
          target: x86_64-unknown-none

      - name: 游댢 Configurar Cache do Cargo
        uses: actions/cache@v4
        with:
          path: |
            ~/.cargo/registry
            ~/.cargo/git
            target
          key: ${{ runner.os }}-cargo-${{ hashFiles('**/Cargo.lock') }}
          restore-keys: |
            ${{ runner.os }}-cargo-
      
      # --- Etapa de Compila칞칚o H칤brida ---
      
      - name: 游댣 Build do C칩digo C (Bootloader/Core)
        # Assumindo que seu c칩digo C est치 em um subdiret칩rio e usa um Makefile simples
        # Voc칡 deve adaptar o caminho e o comando para o seu projeto C.
        run: |
          # Exemplo de comando de make para a parte C
          make -C c_core/ all
        # O 'make' do C deve ser configurado para gerar um objeto (ex: c_core/boot.o)
        # que o build do Rust ir치 linkar.

      - name: 游 Build do M칩dulo/Kernel Rust (x86_64-unknown-none)
        # O comando cargo build deve usar o alvo bare-metal e incluir features necess치rias
        run: |
          # Adapte o caminho e o nome da pasta do seu c칩digo Rust se necess치rio
          cargo build --target x86_64-unknown-none
        working-directory: rust_kernel/

      # --- Etapa de Teste (Exemplo de Lint/Estilo) ---

      - name: 游눈 Executar Lint (Clippy)
        run: cargo clippy --target x86_64-unknown-none -- -D warnings
        working-directory: rust_kernel/

      # Nota: Testes unit치rios padr칚o (cargo test) n칚o funcionam diretamente em targets no_std
      # sem um framework de teste bare-metal.
      
      # --- Etapa de Empacotamento/Artefato ---
      
      - name: 游닍 Upload do Bin치rio do Kernel (Artefato)
        uses: actions/upload-artifact@v4
        with:
          name: lightos-kernel
          # Assumindo que o bin치rio final 칠 gerado nesta localiza칞칚o
          path: rust_kernel/target/x86_64-unknown-none/debug/lightos-kernel

